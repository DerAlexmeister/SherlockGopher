name: Go Test
on: [push]
jobs:
    build:
        name: Build
        runs-on: ubuntu-latest
        steps:
            - name: Set up Go 1.13
              uses: actions/setup-go@v1
              with:
                  go-version: 1.13
              id: go

            - name: Check out code into the Go module directory
              uses: actions/checkout@v2

            - name: Get dependencies
              run: |
                  go get -v -t -d
                  if [ -f Gopkg.toml ]; then
                      curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh
                      dep ensure
                  fi
            - name: Test
              run: |
                  sudo apt install pkg-config
                  wget https://github.com/neo4j-drivers/seabolt/releases/download/v1.7.4/seabolt-1.7.4-Linux-ubuntu-18.04.deb
                  sudo apt install -f ./seabolt-1.7.4-Linux-ubuntu-18.04.deb
                  sudo rm ./seabolt-1.7.4-Linux-ubuntu-18.04.deb
                  export PKG_CONFIG_PATH="/usr/local/share/pkgconfig"
                  export PKG_CONFIG_PATH=/seabolt/build/dist/share/pkgconfig
                  export LD_LIBRARY_PATH=/seabolt/build/dist/lib64
                  export C_INCLUDE_PATH=/seabolt/build/dist/includ
                  go get github.com/neo4j/neo4j-go-driver/neo4j
                  go test -v -coverprofile cover.out ./...
                  go tool cover -func cover.out

            - name: Lint
              uses: actions-contrib/golangci-lint@v1
              env:
                  GOROOT: ""
              with:
                  args: "run"
